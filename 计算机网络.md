# ping 的原理
## ip协议的助手-- ICMP协议
ping是基于ICMP协议工作的，所以要明白ping的工作，首先要熟悉ICMP协议。

### ICMP的概念
Internet Control Message Protocol-互联网控制报文协议

网络包在复杂的网络传输环境里，常常会遇到各种问题。当遇到问题的时候，总不能死个不明不白，没头没脑的作风不是计算机网络的风格。所以需要传出消息，报告遇到了什么问题，这样才可以调整传输策略，以此来控制整个局面。

### ICMP的功能
ICMP的功能包括：确认IP包是否成功送达目标地址、报告发送过程中IP包被废弃的原因和改善网络设置等。

在IP通信中，如果某个IP包因为某种原因未能达到目标地址，那么这个具体的原因将由ICMP负责通知。

[![ROOk5T.png](https://z3.ax1x.com/2021/07/08/ROOk5T.png)](https://imgtu.com/i/ROOk5T)
主机A向主机B发送了数据包，由于某种原因，途中的路由器2未能发现主机B的存在，这时路由器2就会向主机A发送一个ICMP目标不可达数据包，说明发往主机B的包未能成功。

ICMP的通知消息会使用IP进行发送。

因此，从路由器2返回的ICMP包会按照往常的路由控制先经过路由器1再转发给主机A

收到该ICMP包的主机A则分解ICMP的首部和数据域以后得知具体发生问题的原因。